<!DOCTYPE html>
<html>
<head>
    <title>Singapore HDB Price Predictor</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
  <link rel="stylesheet" href="style.css">
</head>
<body>
    <div id="map"></div>

    <div id="inputForm">
      <form>
        <div class="form-group">
            <label for="year">Year:</label>
            <select id="year" name="year">
                <!-- Year options will be populated here -->
            </select><br><br>
        </div>
        <div class="form-group">
            <label for="storeyRange">Storey Range:</label>
            <select id="storeyRange" name="storeyRange">
                <!-- Storey range options -->
            </select><br><br>
        </div>
        <div class="form-group">
            <label for="flatType">Flat Type:</label>
            <select id="flatType" name="flatType">
                <!-- Flat type options -->
            </select><br><br>
        </div>
        <div class="form-group">
          <label for="floorArea">Floor Area:</label>
          <select id="floorArea" name="floorArea">
              <!-- Floor area options will be populated here -->
          </select><br><br>
        </div>
        <input id="predictButton" type="submit" value="Predict Price" class="center-button">
        <button id="showBlueMarkersBtn">Show HDBs</button>
    </form>
    </div>

    <script src="zones.js"></script>
    <script src="hdbLocations.js"></script>

    <script>
        var blueMarkers = [];
        var markersVisible = false;

        var map = L.map('map').setView([1.3521, 103.8198], 12); // Coordinates of Singapore
        L.tileLayer('https://{s}.basemaps.cartocdn.com/light_nolabels/{z}/{x}/{y}.png', {
            maxZoom: 19 ,
        }).addTo(map);

        console.log("Map initialized", map);

        var southWest = L.latLng(1.217, 103.603), // These coordinates might need adjustment
        northEast = L.latLng(1.470, 104.0);
        var bounds = L.latLngBounds(southWest, northEast);
        map.setMaxBounds(bounds);
        map.on('drag', function() {
            map.panInsideBounds(bounds, { animate: false });
        });


        for (var zoneName in zones) {
        if (zones.hasOwnProperty(zoneName)) {
            // Create a polygon for the current zone
            var zoneBoundary = L.polygon(zones[zoneName], {color: 'red'}).addTo(map);

            // Bind a tooltip with the zone name (centralized in the polygon)
            zoneBoundary.bindTooltip(zoneName, {
                permanent: true,
                direction: 'center',
                className: 'zone-label' // CSS class for styling
            }).openTooltip();

            // Event listeners for the polygon
            zoneBoundary.on('mouseover', function (e) {
                this.setStyle({color: 'blue'});
            });
            zoneBoundary.on('mouseout', function (e) {
                this.setStyle({color: 'red'});
            });
            zoneBoundary.on('click', function (e) {
                document.getElementById('inputForm').style.display = 'block';
            });
        }
    }

    function toggleMarkers() {
    if (!markersVisible) {
        if (blueMarkers.length === 0) {
            // Add markers only if they haven't been added before
            mapPoints.forEach(function(point) {
                var lat = parseFloat(point.latitude);
                var lon = parseFloat(point.longitude);

                var marker = L.circleMarker([lat, lon], {
                    className: 'transparent-marker',
                    color: 'blue',
                    fillColor: '#30f',
                    fillOpacity: 0.5,
                    radius: 5
                });

                // Bind a popup to the marker
                marker.bindPopup(point.address);

                marker.addTo(map);
                blueMarkers.push(marker); // Store the marker
            });
        } else {
            // If markers already exist, simply show them
            blueMarkers.forEach(function(marker) {
                marker.addTo(map);
            });
        }
        markersVisible = true;
        document.getElementById('showBlueMarkersBtn').innerText = 'Hide HDBs';
    } else {
        // Hide the markers
        blueMarkers.forEach(function(marker) {
            map.removeLayer(marker);
        });
        markersVisible = false;
        document.getElementById('showBlueMarkersBtn').innerText = 'Show HDBs';
    }
}

        document.getElementById('showBlueMarkersBtn').addEventListener('click', function(e) {
        e.preventDefault();
        toggleMarkers();
    });

    map.on('click', function(e) {
        var lat = e.latlng.lat;  // Latitude of the click
        var lon = e.latlng.lng;  // Longitude of the click

        // You can then use these coordinates as needed
        console.log("Clicked at Latitude: " + lat + ", Longitude: " + lon);
    });

        document.getElementById('inputForm').addEventListener('submit', async function(e){
        e.preventDefault();
        // Get user input values
        var year = document.getElementById('year').value;
        var rooms = document.getElementById('rooms').value;
        var storeyRange = document.getElementById('storeyRange').value;
        var floorArea = document.getElementById('floorArea').value;

        // Prepare data for API call
        var data = {
            year: year,
            rooms: rooms,
            storeyRange: storeyRange,
            floorArea: floorArea
        };

        try {
            // Call the API
            var response = await fetch('YOUR_API_ENDPOINT', {
                method: 'POST', // or 'GET', depending on your API
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(data)
            });

            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }

            // Get the prediction result
            var result = await response.json();

            // Display the result
            displayPrediction(result.predictedPrice); // Assuming 'predictedPrice' is a field in your response

        } catch (error) {
            console.error('Error during API call:', error);
        }
    });

    function displayPrediction(price) {
        // Create or update an element to display the price
        var resultDiv = document.getElementById('result');
        if (!resultDiv) {
            resultDiv = document.createElement('div');
            resultDiv.id = 'result';
            document.body.appendChild(resultDiv);
        }
        resultDiv.innerHTML = `Predicted Price: ${price}`;
    }

    var yearSelect = document.getElementById('year');
    for (var i = 2024; i <= 2033; i++) {
        var option = document.createElement('option');
        option.value = i;
        option.text = i;
        yearSelect.appendChild(option);
    }

    var storeyRanges = ["01 - 03", "01 - 05", "04 - 06", "06 - 10", "07 - 09", "10 - 12",
                    "11 - 15", "13 - 15", "16 - 18", "16 - 20", "19 - 21", "21 - 25",
                    "22 - 24", "25 - 27", "26 - 30", "28 - 30", "31 - 33", "31 - 35",
                    "34 - 36", "36 - 40", "37 - 39", "40 - 42", "43 - 45", "46 - 48", "49 - 51"];

    var storeyRangeSelect = document.getElementById('storeyRange');
    storeyRanges.forEach(function(range) {
        var option = document.createElement('option');
        option.value = range;
        option.text = range;
        storeyRangeSelect.appendChild(option);
    });

    var flatTypes = ["1 Room", "2 Room", "3 Room", "4 Room", "5 Room", "Executive", "Multi-gen"];
    var flatTypeSelect = document.getElementById('flatType');
    flatTypes.forEach(function(type) {
        var option = document.createElement('option');
        option.value = type;
        option.text = type;
        flatTypeSelect.appendChild(option);
    });

    var floorAreaSelect = document.getElementById('floorArea');
    for (var i = 30; i <= 310; i += 10) { // Adjust the increment if needed
        var option = document.createElement('option');
        option.value = i;
        option.text = i + ' sqm'; // Display text with 'sqm' for clarity
        floorAreaSelect.appendChild(option);
    }

    </script>
</body>
</html>
